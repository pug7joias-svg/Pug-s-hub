--[[
    Pug's HUB - FPS FLICK (Minimal)
    Só Aimbot + ESP + FOV Circle + Team Check
    V1.6 - pug7joias
]]--

getgenv().Pug = getgenv().Pug or {}

local WindUI = loadstring(game:HttpGet("https://github.com/Footagesus/WindUI/releases/latest/download/main.lua"))()
if not WindUI then return end

-- Configurações mínimas
Pug.AimbotEnabled = false
Pug.WallCheck = false
Pug.TeamCheck = true   -- novo: ignora players do mesmo time
Pug.SmoothAim = 5
Pug.FOVSize = 150
Pug.FOVEnabled = true  -- FOV circle visível por padrão

Pug.ESPSettings = {
    Outline = {Enabled = true},
    Name = {Enabled = true},
    Skeleton = {Enabled = false},
    Tracer = {Enabled = false}
}

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Camera = workspace.CurrentCamera
local LocalPlayer = Players.LocalPlayer

-- FOV Circle (vermelho fixo, sempre no centro da tela)
local FOVGui = Instance.new("ScreenGui")
FOVGui.Name = "Pug_FOVCircle"
FOVGui.ResetOnSpawn = false
FOVGui.IgnoreGuiInset = true
FOVGui.Parent = LocalPlayer:WaitForChild("PlayerGui")

local FOVCircle = Instance.new("Frame")
FOVCircle.Name = "Circle"
FOVCircle.AnchorPoint = Vector2.new(0.5, 0.5)
FOVCircle.BackgroundTransparency = 1
FOVCircle.Size = UDim2.new(0, Pug.FOVSize * 2, 0, Pug.FOVSize * 2)
FOVCircle.Position = UDim2.new(0.5, 0, 0.5, 0)
FOVCircle.Visible = Pug.FOVEnabled
FOVCircle.Parent = FOVGui

local Stroke = Instance.new("UIStroke")
Stroke.Color = Color3.fromRGB(255, 0, 0)
Stroke.Thickness = 2
Stroke.Parent = FOVCircle

local Corner = Instance.new("UICorner")
Corner.CornerRadius = UDim.new(1, 0)
Corner.Parent = FOVCircle

-- Função para pegar o alvo mais próximo (com team check)
function Pug.GetClosestPlayer()
    local closest = nil
    local shortest = math.huge
    local center = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y / 2)

    local myTeam = LocalPlayer.Team

    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character and player.Team ~= myTeam or not Pug.TeamCheck then
            local char = player.Character
            local head = char:FindFirstChild("Head")
            local humanoid = char:FindFirstChild("Humanoid")
            local root = char:FindFirstChild("HumanoidRootPart")

            if head and humanoid and humanoid.Health > 0 and root then
                local screenPos, onScreen = Camera:WorldToViewportPoint(head.Position)
                if onScreen then
                    local dist = (Vector2.new(screenPos.X, screenPos.Y) - center).Magnitude
                    if dist < Pug.FOVSize and dist < shortest then
                        if Pug.WallCheck then
                            local rayParams = RaycastParams.new()
                            rayParams.FilterDescendantsInstances = {LocalPlayer.Character or game}
                            rayParams.FilterType = Enum.RaycastFilterType.Exclude
                            local ray = workspace:Raycast(Camera.CFrame.Position, (head.Position - Camera.CFrame.Position).Unit * 5000, rayParams)
                            if ray and ray.Instance and ray.Instance:IsDescendantOf(char) then
                                closest = player
                                shortest = dist
                            end
                        else
                            closest = player
                            shortest = dist
                        end
                    end
                end
            end
        end
    end
    return closest
end

-- ESP simples (box + name + distância)
Pug.ESPObjects = {}

function Pug.CreateESP(player)
    if Pug.ESPObjects[player] then return end
    Pug.ESPObjects[player] = {Box = {}, Name = nil}
end

function Pug.RemoveESP(player)
    if Pug.ESPObjects[player] then
        for _, line in pairs(Pug.ESPObjects[player].Box or {}) do pcall(function() line:Remove() end) end
        if Pug.ESPObjects[player].Name then pcall(function() Pug.ESPObjects[player].Name:Remove() end) end
        Pug.ESPObjects[player] = nil
    end
end

-- Setup inicial de players
for _, player in pairs(Players:GetPlayers()) do
    if player ~= LocalPlayer then
        player.CharacterAdded:Connect(function() Pug.RemoveESP(player) end)
    end
end

Players.PlayerAdded:Connect(function(player)
    player.CharacterAdded:Connect(function() Pug.RemoveESP(player) end)
end)

Players.PlayerRemoving:Connect(Pug.RemoveESP)

-- Update ESP + Aimbot
RunService.RenderStepped:Connect(function()
    -- Atualiza tamanho do FOV circle
    FOVCircle.Size = UDim2.new(0, Pug.FOVSize * 2, 0, Pug.FOVSize * 2)
    FOVCircle.Visible = Pug.FOVEnabled

    -- Aimbot
    if Pug.AimbotEnabled then
        local target = Pug.GetClosestPlayer()
        if target and target.Character and target.Character:FindFirstChild("Head") then
            local headPos = target.Character.Head.Position
            local camPos = Camera.CFrame.Position
            local targetCF = CFrame.new(camPos, headPos)
            Camera.CFrame = Camera.CFrame:Lerp(targetCF, 1 / Pug.SmoothAim)
        end
    end

    -- ESP update (só box + name por enquanto)
    pcall(function()
        for _, player in pairs(Players:GetPlayers()) do
            if player == LocalPlayer or not player.Character then
                Pug.RemoveESP(player)
                continue
            end

            if Pug.TeamCheck and player.Team == LocalPlayer.Team then
                Pug.RemoveESP(player)
                continue
            end

            local char = player.Character
            local root = char:FindFirstChild("HumanoidRootPart")
            local head = char:FindFirstChild("Head")
            local hum = char:FindFirstChild("Humanoid")

            if not root or not head or not hum or hum.Health <= 0 then
                Pug.RemoveESP(player)
                continue
            end

            Pug.CreateESP(player)

            local headPos, onScreen = Camera:WorldToViewportPoint(head.Position + Vector3.new(0, 0.5, 0))
            local rootPos = Camera:WorldToViewportPoint(root.Position)
            local legPos = Camera:WorldToViewportPoint(root.Position - Vector3.new(0, 3, 0))

            if not onScreen then
                for _, line in pairs(Pug.ESPObjects[player].Box or {}) do line.Visible = false end
                if Pug.ESPObjects[player].Name then Pug.ESPObjects[player].Name.Visible = false end
                continue
            end

            local height = math.abs(headPos.Y - legPos.Y)
            local width = height / 2

            -- Box (4 linhas)
            if Pug.ESPSettings.Outline.Enabled then
                if #Pug.ESPObjects[player].Box == 0 then
                    for i = 1, 4 do
                        local line = Drawing.new("Line")
                        line.Thickness = 2
                        line.Transparency = 1
                        table.insert(Pug.ESPObjects[player].Box, line)
                    end
                end

                Pug.ESPObjects[player].Box[1].From = Vector2.new(rootPos.X - width, headPos.Y)
                Pug.ESPObjects[player].Box[1].To = Vector2.new(rootPos.X + width, headPos.Y)
                Pug.ESPObjects[player].Box[1].Visible = true

                Pug.ESPObjects[player].Box[2].From = Vector2.new(rootPos.X - width, legPos.Y)
                Pug.ESPObjects[player].Box[2].To = Vector2.new(rootPos.X + width, legPos.Y)
                Pug.ESPObjects[player].Box[2].Visible = true

                Pug.ESPObjects[player].Box[3].From = Vector2.new(rootPos.X - width, headPos.Y)
                Pug.ESPObjects[player].Box[3].To = Vector2.new(rootPos.X - width, legPos.Y)
                Pug.ESPObjects[player].Box[3].Visible = true

                Pug.ESPObjects[player].Box[4].From = Vector2.new(rootPos.X + width, headPos.Y)
                Pug.ESPObjects[player].Box[4].To = Vector2.new(rootPos.X + width, legPos.Y)
                Pug.ESPObjects[player].Box[4].Visible = true
            end

            -- Name + Distância
            if Pug.ESPSettings.Name.Enabled then
                if not Pug.ESPObjects[player].Name then
                    Pug.ESPObjects[player].Name = Drawing.new("Text")
                    Pug.ESPObjects[player].Name.Center = true
                    Pug.ESPObjects[player].Name.Outline = true
                    Pug.ESPObjects[player].Name.Size = 14
                    Pug.ESPObjects[player].Name.Color = Color3.fromRGB(255, 255, 0)
                end

                local dist = (root.Position - Camera.CFrame.Position).Magnitude
                Pug.ESPObjects[player].Name.Text = player.Name .. " [" .. math.floor(dist) .. "m]"
                Pug.ESPObjects[player].Name.Position = Vector2.new(headPos.X, headPos.Y - 20)
                Pug.ESPObjects[player].Name.Visible = true
            end
        end
    end)
end)

-- Janela mínima (só as opções necessárias)
Pug.Window = WindUI:CreateWindow({
    Title = "Pug's HUB | FLICK",
    Author = "pug7joias",
    Size = UDim2.new(0, 380, 0, 320),
    Keybind = Enum.KeyCode.RightControl,
})

local tab = Pug.Window:Tab({Title = "Main", Icon = "crosshair"})

tab:Toggle({Title = "Ativar Aimbot", Default = false, Callback = function(v) Pug.AimbotEnabled = v end})
tab:Toggle({Title = "Wall Check", Default = false, Callback = function(v) Pug.WallCheck = v end})
tab:Toggle({Title = "Team Check", Default = true, Callback = function(v) Pug.TeamCheck = v end})
tab:Slider({Title = "Suavização", Min = 1, Max = 20, Default = 5, Callback = function(v) Pug.SmoothAim = v end})
tab:Slider({Title = "Tamanho FOV", Min = 50, Max = 400, Default = 150, Callback = function(v) Pug.FOVSize = v end})
tab:Toggle({Title = "Mostrar FOV Circle", Default = true, Callback = function(v) Pug.FOVEnabled = v end})

-- Notificação
WindUI:Notify({
    Title = "Pug's HUB Minimal Carregado",
    Content = "Apenas Aimbot + ESP + FOV Circle + Team Check",
    Duration = 4,
})

print("Pug's HUB Minimal - Carregado! Só aim + esp + fov")
