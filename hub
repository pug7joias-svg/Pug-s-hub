--[[
    Pug's HUB - FLICK (Atualizado)
    Aimbot + ESP completo + FOV Circle + Team Check
    Com abas separadas pra ajustar tudo
]]--

getgenv().Pug = getgenv().Pug or {}

local WindUI = loadstring(game:HttpGet("https://github.com/Footagesus/WindUI/releases/latest/download/main.lua"))()
if not WindUI then return end

-- Configs
Pug.AimbotEnabled = false
Pug.WallCheck = false
Pug.TeamCheck = true
Pug.SmoothAim = 5
Pug.FOVSize = 150
Pug.ShowFOV = true

Pug.ESPBox = false
Pug.ESPName = true
Pug.ESPSkeleton = false
Pug.ESPTracer = false

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Camera = workspace.CurrentCamera
local LocalPlayer = Players.LocalPlayer

-- FOV Circle
local FOVGui = Instance.new("ScreenGui", LocalPlayer:WaitForChild("PlayerGui"))
FOVGui.Name = "PugFOV"
FOVGui.ResetOnSpawn = false
FOVGui.IgnoreGuiInset = true

local FOVCircle = Instance.new("Frame", FOVGui)
FOVCircle.Name = "Circle"
FOVCircle.AnchorPoint = Vector2.new(0.5, 0.5)
FOVCircle.BackgroundTransparency = 1
FOVCircle.Position = UDim2.new(0.5, 0, 0.5, 0)
FOVCircle.Size = UDim2.new(0, Pug.FOVSize * 2, 0, Pug.FOVSize * 2)
FOVCircle.Visible = Pug.ShowFOV

local Stroke = Instance.new("UIStroke", FOVCircle)
Stroke.Color = Color3.fromRGB(255, 0, 0)
Stroke.Thickness = 2

local Corner = Instance.new("UICorner", FOVCircle)
Corner.CornerRadius = UDim.new(1, 0)

-- Get Closest Player
function Pug.GetClosest()
    local closest, shortest = nil, math.huge
    local center = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y / 2)
    local myTeam = LocalPlayer.Team

    for _, plr in Players:GetPlayers() do
        if plr ~= LocalPlayer and plr.Character and (not Pug.TeamCheck or plr.Team ~= myTeam) then
            local char = plr.Character
            local head = char:FindFirstChild("Head")
            local hum = char:FindFirstChild("Humanoid")
            local root = char:FindFirstChild("HumanoidRootPart")

            if head and hum and hum.Health > 0 and root then
                local pos, onScr = Camera:WorldToViewportPoint(head.Position)
                if onScr then
                    local dist = (Vector2.new(pos.X, pos.Y) - center).Magnitude
                    if dist < Pug.FOVSize and dist < shortest then
                        if Pug.WallCheck then
                            local params = RaycastParams.new()
                            params.FilterDescendantsInstances = {LocalPlayer.Character}
                            params.FilterType = Enum.RaycastFilterType.Blacklist
                            local ray = workspace:Raycast(Camera.CFrame.Position, (head.Position - Camera.CFrame.Position).Unit * 5000, params)
                            if ray and ray.Instance and ray.Instance:IsDescendantOf(char) then
                                closest, shortest = plr, dist
                            end
                        else
                            closest, shortest = plr, dist
                        end
                    end
                end
            end
        end
    end
    return closest
end

-- ESP system (box, name, skeleton, tracer)
Pug.ESPObjects = {}

function Pug.UpdateESP()
    for _, plr in Players:GetPlayers() do
        if plr == LocalPlayer or not plr.Character then continue end

        if Pug.TeamCheck and plr.Team == LocalPlayer.Team then
            if Pug.ESPObjects[plr] then Pug.RemoveESP(plr) end
            continue
        end

        local char = plr.Character
        local root = char:FindFirstChild("HumanoidRootPart")
        local head = char:FindFirstChild("Head")
        local hum = char:FindFirstChild("Humanoid")

        if not root or not head or not hum or hum.Health <= 0 then
            Pug.RemoveESP(plr)
            continue
        end

        Pug.CreateESP(plr)

        local headScr, onScr = Camera:WorldToViewportPoint(head.Position + Vector3.new(0,0.5,0))
        local rootScr = Camera:WorldToViewportPoint(root.Position)
        local legScr = Camera:WorldToViewportPoint(root.Position - Vector3.new(0,3,0))

        if not onScr then
            Pug.HideESP(plr)
            continue
        end

        local h = math.abs(headScr.Y - legScr.Y)
        local w = h / 2

        -- Box
        if Pug.ESPBox then
            local box = Pug.ESPObjects[plr].Box
            box[1].From = Vector2.new(rootScr.X - w, headScr.Y); box[1].To = Vector2.new(rootScr.X + w, headScr.Y); box[1].Visible = true
            box[2].From = Vector2.new(rootScr.X - w, legScr.Y); box[2].To = Vector2.new(rootScr.X + w, legScr.Y); box[2].Visible = true
            box[3].From = Vector2.new(rootScr.X - w, headScr.Y); box[3].To = Vector2.new(rootScr.X - w, legScr.Y); box[3].Visible = true
            box[4].From = Vector2.new(rootScr.X + w, headScr.Y); box[4].To = Vector2.new(rootScr.X + w, legScr.Y); box[4].Visible = true
        end

        -- Name + Dist
        if Pug.ESPName then
            local name = Pug.ESPObjects[plr].Name
            local dist = math.floor((root.Position - Camera.CFrame.Position).Magnitude)
            name.Text = plr.Name .. " [" .. dist .. "m]"
            name.Position = Vector2.new(headScr.X, headScr.Y - 25)
            name.Visible = true
        end

        -- Skeleton e Tracer (placeholder - se quiser ativar, me avisa que adiciono o código completo)
    end
end

function Pug.CreateESP(plr)
    if Pug.ESPObjects[plr] then return end
    Pug.ESPObjects[plr] = {Box = {}, Name = nil}

    for i = 1, 4 do
        local line = Drawing.new("Line")
        line.Thickness = 2
        line.Transparency = 1
        line.Color = Color3.fromRGB(255, 255, 255)
        table.insert(Pug.ESPObjects[plr].Box, line)
    end

    Pug.ESPObjects[plr].Name = Drawing.new("Text")
    Pug.ESPObjects[plr].Name.Center = true
    Pug.ESPObjects[plr].Name.Outline = true
    Pug.ESPObjects[plr].Name.Size = 14
    Pug.ESPObjects[plr].Name.Color = Color3.fromRGB(255, 255, 100)
end

function Pug.HideESP(plr)
    if Pug.ESPObjects[plr] then
        for _, line in Pug.ESPObjects[plr].Box do line.Visible = false end
        if Pug.ESPObjects[plr].Name then Pug.ESPObjects[plr].Name.Visible = false end
    end
end

function Pug.RemoveESP(plr)
    if Pug.ESPObjects[plr] then
        for _, line in Pug.ESPObjects[plr].Box do pcall(function() line:Remove() end) end
        if Pug.ESPObjects[plr].Name then pcall(function() Pug.ESPObjects[plr].Name:Remove() end) end
        Pug.ESPObjects[plr] = nil
    end
end

-- Loop principal
RunService.RenderStepped:Connect(function()
    FOVCircle.Size = UDim2.new(0, Pug.FOVSize * 2, 0, Pug.FOVSize * 2)
    FOVCircle.Visible = Pug.ShowFOV

    if Pug.AimbotEnabled then
        local target = Pug.GetClosest()
        if target and target.Character and target.Character:FindFirstChild("Head") then
            local headPos = target.Character.Head.Position
            local camPos = Camera.CFrame.Position
            local targetCF = CFrame.new(camPos, headPos)
            Camera.CFrame = Camera.CFrame:Lerp(targetCF, 1 / Pug.SmoothAim)
        end
    end

    Pug.UpdateESP()
end)

-- UI com abas separadas
Pug.Window = WindUI:CreateWindow({
    Title = "Pug's HUB | FLICK",
    Author = "pug7joias",
    Size = UDim2.new(0, 420, 0, 380),
    Keybind = Enum.KeyCode.RightControl,
})

local aimTab = Pug.Window:Tab({Title = "Aimbot", Icon = "crosshair"})
local espTab = Pug.Window:Tab({Title = "ESP", Icon = "eye"})

-- Aba Aimbot
aimTab:Toggle({Title = "Ativar Aimbot", Default = false, Callback = function(v) Pug.AimbotEnabled = v end})
aimTab:Toggle({Title = "Wall Check", Default = false, Callback = function(v) Pug.WallCheck = v end})
aimTab:Toggle({Title = "Team Check", Default = true, Callback = function(v) Pug.TeamCheck = v end})
aimTab:Slider({Title = "Suavização", Min = 1, Max = 20, Default = 5, Callback = function(v) Pug.SmoothAim = v end})
aimTab:Slider({Title = "Tamanho FOV", Min = 50, Max = 400, Default = 150, Callback = function(v) Pug.FOVSize = v end})
aimTab:Toggle({Title = "Mostrar FOV Circle", Default = true, Callback = function(v) Pug.ShowFOV = v end})

-- Aba ESP
espTab:Toggle({Title = "Ativar ESP Box", Default = false, Callback = function(v) Pug.ESPBox = v end})
espTab:Toggle({Title = "Ativar ESP Name + Distância", Default = true, Callback = function(v) Pug.ESPName = v end})
espTab:Toggle({Title = "Ativar ESP Skeleton", Default = false, Callback = function(v) Pug.ESPSkeleton = v end})
espTab:Toggle({Title = "Ativar ESP Tracer", Default = false, Callback = function(v) Pug.ESPTracer = v end})

-- Notificação
WindUI:Notify({
    Title = "Pug's HUB FLICK Atualizado",
    Content = "Abas separadas pra Aimbot e ESP - sliders corrigidos!",
    Duration = 5,
})

print("Pug's HUB FLICK - Versão com abas separadas carregada!")
