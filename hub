--[[
    Pug's HUB - FLICK (Corrigido)
    Aimbot + ESP (box + name + dist) + FOV Circle + Team Check
]]--

getgenv().Pug = getgenv().Pug or {}

local WindUI = loadstring(game:HttpGet("https://github.com/Footagesus/WindUI/releases/latest/download/main.lua"))()
if not WindUI then return end

-- Configs
Pug.AimbotEnabled = false
Pug.WallCheck = false
Pug.TeamCheck = true
Pug.SmoothAim = 5      -- default visível no slider
Pug.FOVSize = 150      -- default visível
Pug.ShowFOV = true     -- FOV circle on por default

Pug.ESPBoxEnabled = false
Pug.ESPNameEnabled = true

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Camera = workspace.CurrentCamera
local LocalPlayer = Players.LocalPlayer

-- FOV Circle
local FOVGui = Instance.new("ScreenGui", LocalPlayer:WaitForChild("PlayerGui"))
FOVGui.Name = "PugFOV"
FOVGui.ResetOnSpawn = false
FOVGui.IgnoreGuiInset = true

local FOVCircle = Instance.new("Frame", FOVGui)
FOVCircle.Name = "Circle"
FOVCircle.AnchorPoint = Vector2.new(0.5, 0.5)
FOVCircle.BackgroundTransparency = 1
FOVCircle.Position = UDim2.new(0.5, 0, 0.5, 0)
FOVCircle.Size = UDim2.new(0, Pug.FOVSize * 2, 0, Pug.FOVSize * 2)
FOVCircle.Visible = Pug.ShowFOV

local Stroke = Instance.new("UIStroke", FOVCircle)
Stroke.Color = Color3.fromRGB(255, 0, 0)
Stroke.Thickness = 2

local Corner = Instance.new("UICorner", FOVCircle)
Corner.CornerRadius = UDim.new(1, 0)

-- Get Closest (com team check)
function Pug.GetClosest()
    local closest, shortest = nil, math.huge
    local center = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y / 2)
    local myTeam = LocalPlayer.Team

    for _, plr in Players:GetPlayers() do
        if plr ~= LocalPlayer and plr.Character and (not Pug.TeamCheck or plr.Team ~= myTeam) then
            local char = plr.Character
            local head = char:FindFirstChild("Head")
            local hum = char:FindFirstChild("Humanoid")
            local root = char:FindFirstChild("HumanoidRootPart")

            if head and hum and hum.Health > 0 and root then
                local pos, onScr = Camera:WorldToViewportPoint(head.Position)
                if onScr then
                    local dist = (Vector2.new(pos.X, pos.Y) - center).Magnitude
                    if dist < Pug.FOVSize and dist < shortest then
                        if Pug.WallCheck then
                            local params = RaycastParams.new()
                            params.FilterDescendantsInstances = {LocalPlayer.Character}
                            params.FilterType = Enum.RaycastFilterType.Blacklist
                            local ray = workspace:Raycast(Camera.CFrame.Position, (head.Position - Camera.CFrame.Position).Unit * 5000, params)
                            if ray and ray.Instance and ray.Instance:IsDescendantOf(char) then
                                closest, shortest = plr, dist
                            end
                        else
                            closest, shortest = plr, dist
                        end
                    end
                end
            end
        end
    end
    return closest
end

-- ESP Objects
Pug.ESP = {}

function Pug.UpdateESP()
    for _, plr in Players:GetPlayers() do
        if plr == LocalPlayer or not plr.Character then continue end

        if Pug.TeamCheck and plr.Team == LocalPlayer.Team then
            if Pug.ESP[plr] then
                if Pug.ESP[plr].Box then for _, l in Pug.ESP[plr].Box do l.Visible = false end end
                if Pug.ESP[plr].Name then Pug.ESP[plr].Name.Visible = false end
            end
            continue
        end

        local char = plr.Character
        local root = char:FindFirstChild("HumanoidRootPart")
        local head = char:FindFirstChild("Head")
        local hum = char:FindFirstChild("Humanoid")

        if not root or not head or not hum or hum.Health <= 0 then
            if Pug.ESP[plr] then
                if Pug.ESP[plr].Box then for _, l in Pug.ESP[plr].Box do l.Visible = false end end
                if Pug.ESP[plr].Name then Pug.ESP[plr].Name.Visible = false end
            end
            continue
        end

        local headScr, onScr = Camera:WorldToViewportPoint(head.Position + Vector3.new(0,0.5,0))
        local rootScr = Camera:WorldToViewportPoint(root.Position)
        local legScr = Camera:WorldToViewportPoint(root.Position - Vector3.new(0,3,0))

        if not onScr then
            if Pug.ESP[plr] then
                if Pug.ESP[plr].Box then for _, l in Pug.ESP[plr].Box do l.Visible = false end end
                if Pug.ESP[plr].Name then Pug.ESP[plr].Name.Visible = false end
            end
            continue
        end

        if not Pug.ESP[plr] then
            Pug.ESP[plr] = {Box = {}, Name = nil}
            for i = 1, 4 do
                local line = Drawing.new("Line")
                line.Thickness = 2
                line.Transparency = 1
                line.Color = Color3.fromRGB(255, 255, 255)
                table.insert(Pug.ESP[plr].Box, line)
            end
            Pug.ESP[plr].Name = Drawing.new("Text")
            Pug.ESP[plr].Name.Center = true
            Pug.ESP[plr].Name.Outline = true
            Pug.ESP[plr].Name.Size = 14
            Pug.ESP[plr].Name.Color = Color3.fromRGB(255, 255, 100)
        end

        local h = math.abs(headScr.Y - legScr.Y)
        local w = h / 2.2

        local box = Pug.ESP[plr].Box
        box[1].From = Vector2.new(rootScr.X - w, headScr.Y); box[1].To = Vector2.new(rootScr.X + w, headScr.Y); box[1].Visible = Pug.ESPBoxEnabled
        box[2].From = Vector2.new(rootScr.X - w, legScr.Y); box[2].To = Vector2.new(rootScr.X + w, legScr.Y); box[2].Visible = Pug.ESPBoxEnabled
        box[3].From = Vector2.new(rootScr.X - w, headScr.Y); box[3].To = Vector2.new(rootScr.X - w, legScr.Y); box[3].Visible = Pug.ESPBoxEnabled
        box[4].From = Vector2.new(rootScr.X + w, headScr.Y); box[4].To = Vector2.new(rootScr.X + w, legScr.Y); box[4].Visible = Pug.ESPBoxEnabled

        local name = Pug.ESP[plr].Name
        local dist = math.floor((root.Position - Camera.CFrame.Position).Magnitude)
        name.Text = plr.Name .. " [" .. dist .. "m]"
        name.Position = Vector2.new(headScr.X, headScr.Y - 25)
        name.Visible = Pug.ESPNameEnabled
    end
end

-- Loop principal
RunService.RenderStepped:Connect(function()
    -- Atualiza FOV circle
    FOVCircle.Size = UDim2.new(0, Pug.FOVSize * 2, 0, Pug.FOVSize * 2)
    FOVCircle.Visible = Pug.ShowFOV

    -- Aimbot
    if Pug.AimbotEnabled then
        local target = Pug.GetClosest()
        if target and target.Character and target.Character:FindFirstChild("Head") then
            local headPos = target.Character.Head.Position
            local camPos = Camera.CFrame.Position
            local targetCF = CFrame.new(camPos, headPos)
            Camera.CFrame = Camera.CFrame:Lerp(targetCF, 1 / Pug.SmoothAim)
        end
    end

    -- ESP
    if Pug.ESPBoxEnabled or Pug.ESPNameEnabled then
        Pug.UpdateESP()
    end
end)

-- UI
Pug.Window = WindUI:CreateWindow({
    Title = "Pug's HUB | FLICK",
    Author = "pug7joias",
    Size = UDim2.new(0, 380, 0, 320),
    Keybind = Enum.KeyCode.RightControl,
})

local tab = Pug.Window:Tab({Title = "Main", Icon = "crosshair"})

tab:Toggle({Title = "Ativar Aimbot", Default = false, Callback = function(v) Pug.AimbotEnabled = v end})
tab:Toggle({Title = "Wall Check", Default = false, Callback = function(v) Pug.WallCheck = v end})
tab:Toggle({Title = "Team Check", Default = true, Callback = function(v) Pug.TeamCheck = v end})
tab:Slider({Title = "Suavização", Min = 1, Max = 20, Default = 5, Value = Pug.SmoothAim, Callback = function(v) Pug.SmoothAim = v end})
tab:Slider({Title = "Tamanho FOV", Min = 50, Max = 400, Default = 150, Value = Pug.FOVSize, Callback = function(v) Pug.FOVSize = v end})
tab:Toggle({Title = "Mostrar FOV Circle", Default = true, Callback = function(v) Pug.ShowFOV = v end})

tab:Divider({Text = "ESP Controls"})
tab:Toggle({Title = "Ativar ESP Box", Default = false, Callback = function(v) Pug.ESPBoxEnabled = v end})
tab:Toggle({Title = "Ativar ESP Name + Distância", Default = true, Callback = function(v) Pug.ESPNameEnabled = v end})

WindUI:Notify({Title = "Pug's HUB FLICK", Content = "Corrigido e pronto! Testa aí mlk", Duration = 4})
print("Pug's HUB FLICK - Carregado corrigido!")
