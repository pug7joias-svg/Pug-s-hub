--[[
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•—  â–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—     â–ˆâ–ˆâ•—  â–ˆâ–ˆâ•—â–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— 
    â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â•â•     â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—
    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ–ˆâ•—    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•
    â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘    â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—
    â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•    â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•
    â•šâ•â•  â•šâ•â•â•šâ•â•  â•šâ•â• â•šâ•â•â•â•â•â•     â•šâ•â•  â•šâ•â• â•šâ•â•â•â•â•â• â•šâ•â•â•â•â•â• 
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    ðŸ”¥ FPS FLICK V1.6 - PUG'S HUB
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
]]--

getgenv().PUG = getgenv().PUG or {}

local WindUI = loadstring(game:HttpGet("https://github.com/Footagesus/WindUI/releases/latest/download/main.lua"))()
if not WindUI then return end

-- ConfiguraÃ§Ãµes padrÃ£o
PUG.AimbotEnabled   = false
PUG.TeamCheck       = true      -- novo
PUG.WallCheck       = false
PUG.SmoothAim       = 5
PUG.FOVSize         = 150
PUG.FOVEnabled      = true
PUG.FOVColor        = Color3.fromRGB(255, 50, 50)

PUG.ESP_Box         = false
PUG.ESP_Name        = true
PUG.ESP_Skeleton    = false
PUG.ESP_Tracer      = false

local Players       = game:GetService("Players")
local RunService    = game:GetService("RunService")
local Camera        = workspace.CurrentCamera
local LocalPlayer   = Players.LocalPlayer

-- ==============================================
-- FOV CIRCLE (usando ScreenGui - compatÃ­vel mobile/PC)
-- ==============================================

local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")

local FOVGui = Instance.new("ScreenGui")
FOVGui.Name = "PUG_FOV"
FOVGui.ResetOnSpawn = false
FOVGui.IgnoreGuiInset = true
FOVGui.Parent = PlayerGui

local FOVFrame = Instance.new("Frame")
FOVFrame.AnchorPoint = Vector2.new(0.5, 0.5)
FOVFrame.Position = UDim2.new(0.5, 0, 0.5, 0)
FOVFrame.Size = UDim2.new(0, 300, 0, 300)
FOVFrame.BackgroundTransparency = 1
FOVFrame.Visible = false
FOVFrame.Parent = FOVGui

local UICorner = Instance.new("UICorner")
UICorner.CornerRadius = UDim.new(1, 0)
UICorner.Parent = FOVFrame

local UIStroke = Instance.new("UIStroke")
UIStroke.Thickness = 2
UIStroke.Color = PUG.FOVColor
UIStroke.Transparency = 0
UIStroke.Parent = FOVFrame

-- ==============================================
-- FunÃ§Ã£o para pegar o alvo mais prÃ³ximo
-- ==============================================

function PUG.GetClosestPlayer()
    local closest = nil
    local shortestDist = math.huge

    local myTeam = LocalPlayer.Team

    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character then
            -- Team check
            if PUG.TeamCheck and player.Team == myTeam then
                continue
            end

            local char = player.Character
            local hrp = char:FindFirstChild("HumanoidRootPart")
            local head = char:FindFirstChild("Head")
            local hum = char:FindFirstChild("Humanoid")

            if hrp and head and hum and hum.Health > 0 then
                local screenPos, onScreen = Camera:WorldToViewportPoint(head.Position)
                if onScreen then
                    local center = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y / 2)
                    local dist = (Vector2.new(screenPos.X, screenPos.Y) - center).Magnitude

                    if dist < PUG.FOVSize and dist < shortestDist then
                        if PUG.WallCheck then
                            local rayParams = RaycastParams.new()
                            rayParams.FilterDescendantsInstances = {LocalPlayer.Character}
                            rayParams.FilterType = Enum.RaycastFilterType.Blacklist

                            local result = workspace:Raycast(
                                Camera.CFrame.Position,
                                (head.Position - Camera.CFrame.Position).Unit * 5000,
                                rayParams
                            )

                            if result and result.Instance and result.Instance:IsDescendantOf(char) then
                                closest = player
                                shortestDist = dist
                            end
                        else
                            closest = player
                            shortestDist = dist
                        end
                    end
                end
            end
        end
    end

    return closest
end

-- ==============================================
-- ESP Simples
-- ==============================================

PUG.ESPObjects = {}

function PUG.CreateESP(player)
    if PUG.ESPObjects[player] then return end

    local box = Drawing.new("Square")
    box.Thickness = 2
    box.Filled = false
    box.Transparency = 1

    local name = Drawing.new("Text")
    name.Size = 13
    name.Center = true
    name.Outline = true
    name.Transparency = 1

    local tracer = Drawing.new("Line")
    tracer.Thickness = 1
    tracer.Transparency = 1

    PUG.ESPObjects[player] = {
        Box = box,
        Name = name,
        Tracer = tracer
    }
end

function PUG.RemoveESP(player)
    if PUG.ESPObjects[player] then
        for _, obj in pairs(PUG.ESPObjects[player]) do
            pcall(function() obj:Remove() end)
        end
        PUG.ESPObjects[player] = nil
    end
end

-- Atualiza ESP
function PUG.UpdateESP()
    local myTeam = LocalPlayer.Team

    for _, player in pairs(Players:GetPlayers()) do
        if player == LocalPlayer then continue end

        -- Team check no ESP tambÃ©m
        if PUG.TeamCheck and player.Team == myTeam then
            PUG.RemoveESP(player)
            continue
        end

        local char = player.Character
        if not char then
            PUG.RemoveESP(player)
            continue
        end

        local hrp = char:FindFirstChild("HumanoidRootPart")
        local head = char:FindFirstChild("Head")
        local hum = char:FindFirstChild("Humanoid")

        if not hrp or not head or not hum or hum.Health <= 0 then
            PUG.RemoveESP(player)
            continue
        end

        local rootPos, onScreen = Camera:WorldToViewportPoint(hrp.Position)
        if not onScreen then
            PUG.RemoveESP(player) -- ou deixar visÃ­vel sÃ³ se quiser offscreen
            continue
        end

        PUG.CreateESP(player)
        local esp = PUG.ESPObjects[player]

        -- Box
        if PUG.ESP_Box then
            local headPos = Camera:WorldToViewportPoint(head.Position + Vector3.new(0, 0.5, 0))
            local legPos = Camera:WorldToViewportPoint(hrp.Position - Vector3.new(0, 3, 0))
            local height = math.abs(headPos.Y - legPos.Y)
            local width = height / 2.2

            esp.Box.Size = Vector2.new(width, height)
            esp.Box.Position = Vector2.new(rootPos.X - width/2, headPos.Y)
            esp.Box.Color = Color3.fromRGB(255, 80, 80)
            esp.Box.Visible = true
        else
            esp.Box.Visible = false
        end

        -- Name + DistÃ¢ncia
        if PUG.ESP_Name then
            local dist = (LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")) and 
                         (hrp.Position - LocalPlayer.Character.HumanoidRootPart.Position).Magnitude or 0

            esp.Name.Text = player.Name .. " [" .. math.floor(dist) .. "m]"
            esp.Name.Position = Vector2.new(rootPos.X, rootPos.Y - 20)
            esp.Name.Color = Color3.fromRGB(255, 255, 100)
            esp.Name.Visible = true
        else
            esp.Name.Visible = false
        end

        -- Tracer
        if PUG.ESP_Tracer then
            esp.Tracer.From = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y)
            esp.Tracer.To = Vector2.new(rootPos.X, rootPos.Y)
            esp.Tracer.Color = Color3.fromRGB(80, 255, 255)
            esp.Tracer.Visible = true
        else
            esp.Tracer.Visible = false
        end
    end
end

-- Limpa ESP de quem saiu
Players.PlayerRemoving:Connect(PUG.RemoveESP)

-- ==============================================
-- INTERFACE
-- ==============================================

local Window = WindUI:CreateWindow({
    Title = "PUG'S HUB | FPS FLICK",
    Size = UDim2.new(0, 480, 0, 380),
})

Window:Tag({Title = "PUG'S HUB", Icon = "skull"})

local TabMain = Window:Tab({Title = "Main", Icon = "crosshair"})

-- Aimbot
TabMain:Toggle({
    Title = "Aimbot",
    Default = false,
    Callback = function(v) PUG.AimbotEnabled = v end
})

TabMain:Toggle({
    Title = "Team Check",
    Default = true,
    Callback = function(v) PUG.TeamCheck = v end
})

TabMain:Toggle({
    Title = "Wall Check",
    Default = false,
    Callback = function(v) PUG.WallCheck = v end
})

TabMain:Slider({
    Title = "SuavizaÃ§Ã£o",
    Min = 1,
    Max = 20,
    Default = 6,
    Callback = function(v) PUG.SmoothAim = v end
})

TabMain:Toggle({
    Title = "Mostrar FOV Circle",
    Default = true,
    Callback = function(v)
        PUG.FOVEnabled = v
        FOVFrame.Visible = v
    end
})

TabMain:Slider({
    Title = "Tamanho do FOV",
    Min = 50,
    Max = 600,
    Default = 150,
    Callback = function(v)
        PUG.FOVSize = v
        local size = v * 2
        FOVFrame.Size = UDim2.new(0, size, 0, size)
    end
})

-- ESP
TabMain:Divider({Text = "ESP"})

TabMain:Toggle({
    Title = "Box",
    Default = false,
    Callback = function(v) PUG.ESP_Box = v end
})

TabMain:Toggle({
    Title = "Nome + DistÃ¢ncia",
    Default = true,
    Callback = function(v) PUG.ESP_Name = v end
})

TabMain:Toggle({
    Title = "Tracer",
    Default = false,
    Callback = function(v) PUG.ESP_Tracer = v end
})

-- ==============================================
-- LOOP PRINCIPAL
-- ==============================================

RunService.RenderStepped:Connect(function()
    -- Atualiza FOV visual
    FOVFrame.Visible = PUG.FOVEnabled

    -- Aimbot
    if PUG.AimbotEnabled then
        local target = PUG.GetClosestPlayer()
        if target and target.Character and target.Character:FindFirstChild("Head") then
            local headPos = target.Character.Head.Position
            local targetCFrame = CFrame.new(Camera.CFrame.Position, headPos)
            Camera.CFrame = Camera.CFrame:Lerp(targetCFrame, 1 / PUG.SmoothAim)
        end
    end

    -- Atualiza ESP
    pcall(PUG.UpdateESP)
end)

-- NotificaÃ§Ã£o de carregamento
WindUI:Notify({
    Title = "PUG'S HUB",
    Content = "Carregado com sucesso! Bora flick ðŸ”¥",
    Duration = 4,
})

print("PUG'S HUB | Carregado com sucesso!")
